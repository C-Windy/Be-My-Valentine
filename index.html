<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ðŸ’– Puzzle For You ðŸ’–</title>

  <style>
    :root{
      --pink1:#ff4d6d;
      --pink2:#ff8fab;
      --pink3:#ffe5ec;
      --card: rgba(255,255,255,0.14);
      --card2: rgba(255,255,255,0.22);
    }

    body{
      margin:0;
      min-height:100vh;
      display:grid;
      place-items:center;
      font-family: Arial, sans-serif;
      text-align:center;
      color:white;
      background: radial-gradient(900px 600px at 25% 15%, rgba(255,255,255,0.18), transparent 55%),
                  radial-gradient(900px 600px at 85% 25%, rgba(255,255,255,0.14), transparent 55%),
                  linear-gradient(135deg, var(--pink1), var(--pink2));
    }

    .card{
      width:min(92vw, 560px);
      background: linear-gradient(180deg, var(--card), var(--card2));
      border: 1px solid rgba(255,255,255,0.20);
      border-radius: 22px;
      padding: 22px 18px;
      box-shadow: 0 18px 40px rgba(0,0,0,0.28);
      backdrop-filter: blur(10px);
    }

    h1{ margin: 8px 0 6px; }
    p{ margin: 0 0 14px; color: rgba(255,255,255,0.86); line-height: 1.5; }

    .previewWrap{
      width: min(90vw, 380px);
      margin: 14px auto 10px;
      padding: 10px;
      border-radius: 18px;
      background: rgba(255,255,255,0.10);
      border: 1px solid rgba(255,255,255,0.18);
    }

    /* NOTE: width/height are set by JS so 3x3 and 4x4 both fit nicely */

    #puzzle{
      margin: 0 auto;
      display: grid;
      gap: 6px;
      position: relative;
      border-radius: 16px;
      overflow: hidden;
    }

    /* faint full-image preview behind the puzzle */
    #puzzle::before{
      content:"";
      position:absolute;
      inset:0;
      background-image:url('us.JPG');
      background-size: cover;
      background-position: center;
      opacity: 0.16;
      pointer-events:none;
      border-radius: 16px;
    }

    .tile{
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.22);
      box-shadow: 0 10px 22px rgba(0,0,0,0.20);
      cursor:pointer;
      position: relative;
      z-index: 1;

      background-image: url('us.JPG');
      background-repeat: no-repeat;
      transition: transform 0.12s ease, outline 0.12s ease, filter 0.12s ease;
    }

    .tile:hover{ transform: translateY(-1px); filter: brightness(1.05); }
    .selected{ outline: 3px solid rgba(255,255,255,0.95); transform: translateY(-2px) scale(1.01); }

    #valentine{ display:none; margin-top: 16px; }

    .btn{
      background: white;
      color: var(--pink1);
      border: none;
      padding: 12px 18px;
      font-size: 18px;
      border-radius: 999px;
      cursor: pointer;
      margin: 10px 8px 0;
      font-weight: 800;
    }
    .btn:hover{ background: var(--pink3); }

    .small{
      font-size: 13px;
      color: rgba(255,255,255,0.75);
      margin-top: 10px;
    }
  </style>
</head>

<body>
  <div class="card">
    <h1>ðŸ’˜ Put Us Back Together ðŸ’˜</h1>
    <p>Click two pieces to swap them. Solve to unlock the question ðŸ’–</p>

    <div class="previewWrap">
      <div id="puzzle" aria-label="Photo puzzle"></div>
    </div>

    <div id="valentine">
      <h2 style="margin:10px 0 6px;">ðŸ’– You solved it ðŸ’–</h2>
      <h1 style="margin:6px 0 8px;">Will you be my Valentine?</h1>
      <button class="btn" onclick="celebrate()">YES ðŸ’•</button>
    </div>

  
  </div>

  <script>
    const puzzle = document.getElementById("puzzle");

    // CHANGE THIS:
    const size = 3; // 3 for 3x3, 4 for 4x4

    const tileCount = size * size;

    // Puzzle board size in px (kept responsive-ish)
    const puzzlePx = (size === 4) ? 360 : 330; // 4x4 slightly bigger
    const tilePx = Math.floor(puzzlePx / size);

    // Apply grid + sizing dynamically
    puzzle.style.width = puzzlePx + "px";
    puzzle.style.height = puzzlePx + "px";
    puzzle.style.gridTemplateColumns = `repeat(${size}, 1fr)`;
    puzzle.style.gridTemplateRows = `repeat(${size}, 1fr)`;

    let mapping = [...Array(tileCount).keys()];
    let selectedIndex = null;

    function buildTiles(){
      puzzle.innerHTML = "";
      for(let i=0; i<tileCount; i++){
        const t = document.createElement("div");
        t.className = "tile";
        t.dataset.slot = i;
        t.style.width = tilePx + "px";
        t.style.height = tilePx + "px";
        puzzle.appendChild(t);
      }
      render();
    }

    function bgPosForPiece(pieceIndex){
      const row = Math.floor(pieceIndex / size);
      const col = pieceIndex % size;
      return `${-col * tilePx}px ${-row * tilePx}px`;
    }

    function render(){
      const tiles = [...puzzle.querySelectorAll(".tile")];
      tiles.forEach((tile, slot) => {
        const pieceIndex = mapping[slot];
        tile.style.backgroundSize = `${puzzlePx}px ${puzzlePx}px`;
        tile.style.backgroundPosition = bgPosForPiece(pieceIndex);
        tile.classList.toggle("selected", selectedIndex === slot);
      });
    }

    function isSolved(){
      for(let i=0; i<tileCount; i++){
        if(mapping[i] !== i) return false;
      }
      return true;
    }

    function shuffle(){
      mapping = [...Array(tileCount).keys()];

      // Easy-ish shuffle: do a controlled number of random swaps
      const swaps = (size === 4) ? 22 : 12; // 4x4 needs more mixing
      for(let k=0; k<swaps; k++){
        const a = Math.floor(Math.random()*tileCount);
        let b = Math.floor(Math.random()*tileCount);
        while(b === a) b = Math.floor(Math.random()*tileCount);
        [mapping[a], mapping[b]] = [mapping[b], mapping[a]];
      }

      // Ensure not already solved
      if(isSolved()){
        [mapping[0], mapping[1]] = [mapping[1], mapping[0]];
      }

      selectedIndex = null;
      render();
      document.getElementById("valentine").style.display = "none";
    }

    puzzle.addEventListener("click", (e) => {
      const tile = e.target.closest(".tile");
      if(!tile) return;

      const slot = Number(tile.dataset.slot);

      if(selectedIndex === null){
        selectedIndex = slot;
        render();
        return;
      }

      if(selectedIndex === slot){
        selectedIndex = null;
        render();
        return;
      }

      [mapping[selectedIndex], mapping[slot]] = [mapping[slot], mapping[selectedIndex]];
      selectedIndex = null;
      render();

      if(isSolved()){
        document.getElementById("valentine").style.display = "block";
        heartBurst();
      }
    });

    function heartBurst(){
      for(let i=0; i<26; i++){
        const s = document.createElement("div");
        s.textContent = Math.random() > 0.5 ? "ðŸ’–" : "ðŸ’—";
        s.style.position = "fixed";
        s.style.left = (Math.random() * 100) + "vw";
        s.style.top = "-20px";
        s.style.fontSize = (16 + Math.random()*22) + "px";
        s.style.opacity = "0.95";
        s.style.transition = "transform 1.4s linear, top 1.4s linear, opacity 1.4s linear";
        document.body.appendChild(s);

        requestAnimationFrame(() => {
          s.style.top = (70 + Math.random()*40) + "vh";
          s.style.transform = `rotate(${Math.random()*60-30}deg) scale(1.1)`;
          s.style.opacity = "0";
        });

        setTimeout(() => s.remove(), 1500);
      }
    }

    function celebrate(){
      alert("ðŸ’– Best decision ever ðŸ’–");
    }

    buildTiles();
    shuffle();
  </script>
</body>
</html>
